# WebLamp
Парные лампы со связью через Интернет на esp8266
![sch](/schemes/scheme.png)

## Возможности
- Связь между двумя лампами через Интернет. Лампы управляют друг другом
- Включение/выключение, смена цвета, функция "подмигнуть"
- Управление яркостью (только локальной лампы)
- Веб-интерфейс для настройки
- Сенсорное управление
- ИК датчик движения

## Подключение
- При подаче питания начнётся подключение к роутеру (лампа мигает зелёным)
  - Если подключение не будет установлено за 15 секунд или юзер кликнет по кнопке, лампа запустит свою точку доступа WiFi (лампа мигает синим)
  - Точка называется **WLamp <ip адрес>**, где ip адрес - последний полученный от роутера адрес (успешное подключение)
  - При подключении к точке доступа должна автоматически открыться страница конфигурации (веб-интерфейс). Если не открылась - перейди в браузере по адресу **192.168.4.1**
  - При сохранении настроек ИЛИ при клике по кнопке лампа будет перезагружена и процесс подключения начнётся заново
- При успешном подключении лампа перейдёт в режим работы и включится настроенным цветом (если включена)
- Страница конфигурации лампы (веб-интерфейс) доступна в локальной сети роутера по IP адресу, который роутер выдал лампе. Чтобы его узнать, можно повторить процедуру подключения
![conn](/schemes/flowchart.png)

## Настройки
Нужно указать на странице конфигурации данные для подключения к роутеру, а также имя своей лампы (Local Name) и её удалённой пары (Remote Name)

## Управление
- 1 клик: вкл/выкл локальную лампу
- 2 клика: сменить цвет
- 3 клик: вкл/выкл локальную и удаленную лампу
- 4 клика: подмигнуть
- Удержание: сменить яркость

## Поведение лампы
- Удалённая лампа не в сети: локальная лампа горит ровным светом
- Удалённая лампа в сети: локальная лампа плавно "дышит" яркостью раз в секунду, тайм-аут 18 секунд
- Сработал ИК датчик на удалённой лампе: локальная лампа плавно "дышит" яркостью 3 раза в секунду, тайм-аут 60 секунд

# Управление лампой через Яндекс Алису
1. Установите Python 3
2. Установите бибилотеки через команду `pip install -r requirements.txt`
3. Откройте файл mqtt.py и замените в начале файла целевую лампу (на строке 16)
4. Запустите код на сервере
5. Откройте навык [Домовенок кузя](https://alexstar.ru/)
6. Настройте все правила также как и на скриншоте ![image](https://github.com/ArtemBay/WebLamp/assets/31122393/d6ff445b-e430-43b5-86c5-94e05c3bc647)
7. Теперь можете использовать приложение Яндекса для управления умным домом или алису через навык "Домовенок Кузя"
